/*
  Notes:
    - <nav class="top-bar"> can have .fixed added to make it stick to the top of viewport. Can add .contain-to-grid to top-bar to make it full width but content on grid.
    - <li class="name"> creates a branding area that can be linked to homepage
      - Can include text, image or both inside this <li>.
    - <li class="divider"> creates a divider between nav items, add margins for space
    - <li class="search"> Needs to hold a <form> which can use .row.collapse and pre/postfix buttons or default type="search"
*/


// Element that controls breakpoint, no need to change this ever
.top-bar-js-breakpoint { width: $topBarBreakPoint !important; visibility: hidden; }

// Wrapped around .top-bar to contain to grid width
.contain-to-grid {
  width: 100%;
  background: $topBarBgColor;
}

// Wrapped around .top-bar to make it fixed at the top
.fixed {
  width: 100%;
  #{$defaultFloat}: 0;
  position: fixed;
  top: 0;
  z-index: 99;
}

// The topbar itself
.top-bar {
  background: $topBarBgColor;
  height: $topBarHeight;
  line-height: $topBarHeight;
  margin: 0 0 $topBarBtmMargin;
  padding: 0;
  width: 100%;
  position: relative;

  // Contain width to .row width
  .contain-to-grid & {
    max-width: $row-width;
    margin: 0 auto;
  }

  /* First <ul> for branding, title, name, etc */
  &>ul {
    .name {
      h1 {
        line-height: $topBarHeight;
        margin: 0;
        a {
          font-weight: $topBarTitleWeight;
          padding: 0 $topBarHeight / 2;
          font-size: $topBarTitleSize !important;
        }
      }
      img {
        margin-top: emCalc(-5px);
        vertical-align: middle;
      }
    }
  }
  &.expanded { height: inherit; }

  // topbar global <ul> styles
  ul {
    margin-#{$defaultFloat}: 0;
    display: inline;
    height: $topBarHeight;
    line-height: $topBarHeight;
    list-style: none;

    // Main Navigation links style
    &>li {
      float: $defaultFloat;

      a:not(.button) {
        color: $topBarLinkColor;
        display: block;
        font-size: $topBarLinkSize;
        font-weight: $topBarLinkWeight;
        height: $topBarHeight;
        line-height: $topBarHeight;
        padding: 0 $topBarHeight / 3;
      }
      &:not(.name) {
        &:hover,
        &.active,
        &:focus { background: darken($topBarBgColor, 15%);
          a { color: darken($topBarLinkColor, 15%); }
        }
      }

      // Dividers between navigation
      &.divider {
        background: darken($topBarBgColor, 15%);
        -webkit-box-shadow: 1px 0 0 rgba(255,255,255,0.10);
        box-shadow: 1px 0 0 rgba(255,255,255,0.10);
        height: 100%;
        margin-#{$defaultOpposite}: 1px;
        width: 1px;
      }

      // Put a button in an <li> but give is a class
      &.has-button {
        a.button { margin: 0 $topBarHeight / 4; }

        &:hover,
        &:focus { background: $topBarBgColor;
          a { color: #fff; }
        }
      }

      // Put a search bar or text input in the bar
      &.search { padding: 0 $topBarHeight / 3;
        form {
          display: inline-block;
          margin-bottom: 0;
          vertical-align: middle;
          width: $topBarSearchWidth;
          input[type=text] {
            @include side-radius($defaultOpposite, 0);
            float: $defaultFloat;
            font-size: ms(0) - 1;
            margin-top: -1px;
            height: $topBarHeight / 2; //28px margin-bottom: 0; width: $topBarSearchWidth - 70px;
            &+.button {
              border-#{$defaultFloat}: none;
              @include side-radius($defaultFloat, 0);
              float: $defaultFloat;
              font-size: emCalc(12px);
              margin-top: -1px;
              padding: emCalc(5px) emCalc(12px) emCalc(4px);
            }
          }
          input[type=search] {
            font-size: emCalc(16px);
            margin-bottom: 0;
          }
        }
        &:hover, &:focus { background: $topBarBgColor; }
      }

      // Hide the triangle for breakpoint menu
      &.toggle-topbar { display: none; }

      // li.has-dropdown
      &.has-dropdown { position: relative;
        &:hover,
        &:focus {
          &>.dropdown {
            display: block;
            visibility: visible;
          }
        }

        a { padding-#{$defaultOpposite}: $topBarHeight * .75;
          &:after {
            @include css-triangle($topBarDropToggleSize, $topBarDropToggleColor, top);
            margin-#{$defaultOpposite}: $topBarHeight / 3;
            margin-top: -$topBarDropToggleSize / 2;
            position: absolute; #{$defaultOpposite}: 0;
            top: 50%;
          }
        }

        .dropdown {
          background: $topBarDropBgColor;
          #{$defaultFloat}: 0;
          margin: 0;
          padding: $topBarHeight / 5 0 0 0;
          position: absolute;
          visibility: hidden;
          z-index: 99;

          li {
            background: $topBarDropBgColor;
            line-height: 1;
            min-width: 100%;
            padding-bottom: emCalc(5px);
            a {
              color: $topBarDropLinkColor;
              font-weight: normal;
              height: 100%;
              line-height: 1;
              padding: emCalc(5px) $topBarHeight / 3 + emCalc(2px) emCalc(5px) $topBarHeight / 3;
              white-space: nowrap;
              &:after { border: none; }
              &:hover, &:focus { background: lighten($topBarDropBgColor, 10%); }
            }

            label {
              color: lighten($topBarDropBgColor, 30%);
              font-size: emCalc(10px);
              font-weight: $topBarLinkWeight;
              margin: 0;
              padding-#{$defaultFloat}: $topBarHeight / 3;
              text-transform: uppercase;
            }
            &.divider {
              border-top: solid 1px darken($topBarDropBgColor, 20%);
              -webkit-box-shadow: inset 0 1px 0 rgba(255,255,255,.10);
              box-shadow: inset 0 1px 0 rgba(255,255,255,.10);
              height: emCalc(10px);
              padding: 0;
              width: 100%;
            }

            &:last-child { padding-bottom: emCalc(10px); }
            &.active a { background: darken($topBarBgColor, 15%); }
          }
        }

        // Dropdown Level 2+
        .dropdown li.has-dropdown {
          &>a { padding-#{$defaultOpposite}: $navBarHeight * .75;
            &:after {
              border: none;
              content:"\00bb";
              #{$defaultOpposite}: emCalc(5px);
              top: emCalc(6px);
            }
          }
          .dropdown {
            position: absolute;
            #{$defaultFloat}: 100%;
            top: 0;
          }
          &:hover, &:focus {
            &>.dropdown { display: block; }
          }
        }
      }
    }

    // Left Side <ul>
    &.left {
      float: left;
      width: auto;
      margin-bottom: 0;
    }

    // Right Side <ul>
    &.right {
      float: right;
      width: auto;
      margin-bottom: 0;

      // Dropdown Right Side Alignment
      .has-dropdown .dropdown {
        left: auto;
        right: -1px;

        li.has-dropdown > .dropdown {
          right: 100%;
          left: auto;
          width: 100%;
        }
      }
    }
  }

  .js-generated { display: none; }
}

/* Firefox Fixes */
@-moz-document url-prefix() {
  .top-bar ul li .button.small { padding-bottom: emCalc(6px); }
  .top-bar ul li.search form input[type=search] { font-size: emCalc(14px); height: emCalc(22px); padding: emCalc(3px); }
}

/* IE8 Fixes */
.lt-ie9 .top-bar ul li a {
  color: $topBarLinkColor;
  display: block;
  font-weight: $topBarLinkWeight;
  font-size: $topBarLinkSize;
  height: $topBarHeight;
  line-height: $topBarHeight;
  padding: 0 $topBarHeight / 3;

  &.button {
    height: auto;
    line-height: emCalc(30px);
    margin-top: emCalc(7px);
  }
  &:hover,
  &:focus { color: darken($topBarLinkColor, 20%); }

  img {
    margin-top: emCalc(-5px);
    vertical-align: middle;
  }
  &.active {
    background: darken($topBarBgColor, 5%);
    color: darken($topBarLinkColor, 15%);
  }
}

.lt-ie9 .top-bar ul li.has-dropdown {
  padding-#{$defaultOpposite}: $topBarHeight * .75;
  &>ul li { padding-#{$defaultOpposite}: 0; }
}


/* Topbar Specific Breakpoint that you can customize */
@media only screen and (max-width: $topBarBreakPoint) {

  .top-bar { margin-bottom: 0; overflow: hidden; height: $topBarHeightMobile; background: $topBarDropBgColor;
    .js-generated { display: block; }

    /* Override contain to grid stuff for breakpoint */
    .contain-to-grid & { width: auto; }

    /* Setting up the sliding area */
    section { #{$defaultFloat}: 0; position: relative; width: auto; @include single-transition($defaultFloat, 300ms); }
    ul { width: 100%; height: 100%; margin-bottom: 0; display: block;
      &>li { float: none;
        &.active, &:hover { background: darken($topBarDropBgColor, 5%); }
        /* Branding and name */
        &.name { height: $topBarHeightMobile;
          h1 { line-height: 1;
            a { color: $topBarLinkColor; display: block; line-height: $topBarHeightMobile !important; padding-#{$defaultFloat}: $topBarHeightMobile / 3; height: $topBarHeightMobile; }
          }
        }
        &:hover, &.active { a { color: $topBarDropLinkColor; } }
        a:not(.button) { color: $topBarDropLinkColor; }

        /* Dropdown Toggle */
        &.toggle-topbar { cursor: pointer; display: block; height: $topBarHeightMobile; position: absolute; #{$defaultOpposite}: 0; top: 0; width: 50%;
          a { @include css-triangle($topBarNavToggleSize, #fff, top); padding: 0; position: absolute; top: 50%; #{$defaultOpposite}: $topBarHeightMobile / 2; margin-top: -($topBarNavToggleSize / 2); }
          @if $topBarBreakPoint == 9999px { a { #{$defaultOpposite}: ($topBarHeight / 2) + ($columnGutter / 2);} }
          &:hover { background: inherit; }
        }
        &.toggle-topbar a { padding: 0 !important; }

        /* Divider for breakpoint */
        &.divider { border-bottom: solid 1px lighten($topBarDropBgColor, 10%); border-top: solid 1px darken($topBarDropBgColor, 15%); clear: both; height: 1px !important; margin: 8px 0 !important; width: 100%; }

        /* Search Overrides for breakpoint size */
        &.search { padding: 0 $topBarHeight / 2;
          form { width: 100%;
            input[type=text] { width: 75%; }
            .button { top: 0; width: 25%; }
          }
        }

        /* Dropdown Level 1 */
        &.has-dropdown {
          a { padding-#{$defaultOpposite}: $topBarHeight * .75;
            &:after { @include css-triangle($topBarDropToggleSize, rgba($topBarDropToggleColor, $topBarDropToggleAlpha), $defaultFloat); margin-#{$defaultOpposite}: $topBarHeight / 3; margin-top: -($topBarDropToggleSize / 2) - 2; position: absolute; top: 50%; }
          }
          &:hover >.dropdown { display: block; visibility: hidden; }
          .dropdown { visibility: hidden; z-index: 0 !important; }
          &.moved { position: static;
            &>.dropdown { top: 0; visibility: visible;
              li {
                label { margin-bottom: emCalc(6px); padding-top: emCalc(6px) !important; font-size: emCalc(11px); }
                &:not(.title) { padding-bottom: 0;
                  a { padding: emCalc(8px) $topBarHeightMobile / 2; font-size: emCalc(14px); }
                }
                a, label { padding: 0 $topBarHeight / 2; }
                a:hover { background: lighten($topBarBgColor, 10%); display: block; }
                &.divider { border-bottom: solid 1px rgba(255,255,255,0.1); margin-top: emCalc(8px) !important; margin-bottom: emCalc(8px) !important; }
              }
            }
            .back.title { padding-bottom: 0;
              a:before { position: absolute; top: 50%; #{$defaultFloat}: ($topBarHeight / 2) - $topBarDropToggleSize; margin-top: -$topBarDropToggleSize; width: 0; height: 0; @include css-triangle($topBarDropToggleSize, $topBarDropToggleColor, $defaultOpposite); }
              h5 { margin: 0; padding-#{$defaultFloat}: $topBarDropToggleSize * 3; position: relative;
                a { background: transparent; padding-top: emCalc(8px); padding-bottom: emCalc(8px); font-size: emCalc(23px); font-weight: $topBarTitleWeight; }
              }
            }
          }
        }

        /* Dropdown Level 2 */
        &.has-dropdown .dropdown li { background: transparent;
          &.has-dropdown {
            .dropdown { #{$defaultFloat}: 100% !important; top: 0; #{$defaultOpposite}: auto !important; }
            &>a { padding-#{$defaultOpposite}: $topBarHeight * .75;
              &:after { content: ""; margin-#{$defaultOpposite}: $topBarHeightMobile / 3; @include css-triangle($topBarDropToggleSize, rgba($topBarDropToggleColor, $topBarDropToggleAlpha), $defaultFloat); position: absolute; top: 50%; margin-top: -($topBarDropToggleSize / 2) - 2; }
              li a {
                &:hover { background: lighten($topBarBgColor, 10%); }
              }
            }
            &.moved { position: static;
              .dropdown { top: 0; visibility: visible; }
            }
            &:hover { display: block; }
          }
        }
      }
      &.left, &.right { float: none; width: 100%;
        &>li { display: block; float: none; margin: 0 !important;
          &.has-dropdown {
            .dropdown { #{$defaultFloat}: 100% !important; top: 0; #{$defaultOpposite}: auto !important; }
          }
        }
      }
    }
    section > ul li a:not(.button) { padding-#{$defaultFloat}: $topBarHeightMobile / 2 !important; }

    /* When the Small Nav is Showing */
    &.expanded { height: 100%;
      ul li.toggle-topbar a { @include css-triangle($topBarNavToggleSize, rgba(255,255,255,0.5), bottom); top: auto; bottom: 50%; margin-bottom: -($topBarNavToggleSize / 2); }
    }
  }
  .top-bar ul li.has-button { padding: emCalc(5px) $topBarHeightMobile / 3; }
  .top-bar ul li .button.small { margin: 0 !important; display: inline-block; width: 100%; }
  .top-bar ul > li.has-button {
    a.button { margin: 0; }
  }
}